<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="team3.promans.interfaces.ScheduleInterface">
<!-- 업무 디테일 작성(글 작성) -->
	<insert id="writeSchedule" parameterType="team3.promans.beans.ScheduleDetailBean">
		INSERT INTO SD(SD_CPCODE,SD_PRCODE,SD_PSCODE,SD_SCCODE,SD_USERID,SD_CODE,SD_TITLE,SD_DATE,SD_STATE)
		VALUES(#{cpcode},#{prcode},#{pscode},#{sccode},#{userid},#{sdcode},#{sdcontent},SYSDATE,'W')
	</insert>

<!-- 업무 일지 작성 -->
	<insert id="writeDiary" parameterType="team3.promans.beans.WorkDiaryBean">
		INSERT INTO WD 
		VALUES(#{cpcode},#{prcode},#{userid},#{wdcode},#{wdtitle},#{wdcontents},TO_CHAR(SYSDATE,'YYYYMMDD'))
	</insert>
	
	<select id="maxdiary" parameterType="team3.promans.beans.WorkDiaryBean" resultType="int">
		select nvl(max(substr(wd_code,3,4)),0) from wd
	</select>
	
<!-- 업무 디테일 완료 요청(일반멤버)-->
	<update id="reqSchedule" parameterType="team3.promans.beans.ScheduleDetailBean">
		UPDATE SCHEDULE_DETAIL SET SD_STATE = 'W'
		WHERE SD_STATE='I' AND
		SD_CPCODE=#{cpcode} AND
		SD_USERID=#{userid} AND
		SD_PRCODE=#{prcode} AND
		SD_PSCODE=#{pscode} AND
		SD_SCCODE=#{sccode} AND
		SD_CODE=#{sdcode} 
	</update> 	
	
	<!-- 업무 디테일 완료 승인(업데이트, 관리자) -->
	<update id="reqPass" parameterType="team3.promans.beans.ScheduleDetailBean">
	  UPDATE SCHEDULE_DETAIL SET SD_STATE = 'S' 
	  WHERE SD_USERID = #{userid} AND SD_STATE = 'W' AND SD_PRCODE = #{prcode}  AND SD_PSCODE = #{pscode} AND SD_SCCODE = #{sccode} AND SD_CODE = #{sdcode}
	  	</update>
	  	
	  	<insert id="scheFeedback" parameterType = "team3.promans.beans.ScheduleDetailBean">
	  	
	  	INSERT INTO FT
	  	VALUES(#{cpcode}, #{prcode}, #{pscode}, #{sccode}, #{sdcode}, #{userid}, 1 , #{sdcontent}, SYSDATE )
	  	
	  	</insert>
	  	
	  	<update id="updateScheFeedback" parameterType = "team3.promans.beans.ScheduleDetailBean">
	  	
	  	 UPDATE SCHEDULE_DETAIL SET SD_STATE = 'I' 
	  	 WHERE SD_USERID = #{userid} AND SD_STATE = 'W' AND SD_PRCODE = #{prcode}  AND SD_PSCODE = #{pscode} AND SD_SCCODE = #{sccode} AND SD_CODE = #{sdcode}
	  	
	  	</update>
	  	
	  	<insert id ="insSD" parameterType = "team3.promans.beans.ScheduleDetailBean">
	  	
	  	INSERT INTO SD VALUES (#{cpcode}, #{prcode}, #{pscode}, #{sccode},#{userid} ,#{sdcode}, #{sdcontent}, SYSDATE, 'I' )
	  	
	  	</insert>
	  	
	  	<insert id ="insSM" parameterType = "team3.promans.beans.ScheduleDetailBean">
	  	
	  	  INSERT INTO SM VALUES(#{cpcode}, #{prcode}, #{pscode}, #{sccode}, #{userid}, 1 , 'G')
	  	
	  	</insert>
	  	
	  	
	  	<select id="maxScCode" parameterType="team3.promans.beans.ScheduleDetailBean" resultType="int">
	  		SELECT NVL(SUBSTR(MAX(SD_CODE),3,4),0) FROM SD WHERE SD_CPCODE = #{cpcode} AND SD_PRCODE = #{prcode} AND SD_SCCODE=#{sccode}
	  	
	  	</select>
</mapper>